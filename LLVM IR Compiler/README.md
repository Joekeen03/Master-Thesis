# Building and Running the Compiler

## Tools 

For building the compiler
* Clang++ 15.0.0; other versions of Clang that support C++17 may also work.
    - Clang is available at https://releases.llvm.org/download.html
    - Technically, any compiler that supports Clang's `-S -emit-llvm` command-line arguments would also work
* GNU Make
    - GNU Make is available at https://www.gnu.org/software/make/#download
    - Other Make programs may also work

## To build and Run the Compiler

1) Clone it to your computer
2) Open a command line/shell and navigate to the "LLVM IR Compiler" folder.
3) Run `make compiler`
    * Final executable will be `main.exe` under "LLVM IR Compiler/build"
4) To use the compiler, run it from the command line with the following arguments: "-ll \<input file path\> -asm \<output file path\>"

# Assembling and Running Test SNES ROMs

This discusses how to assemble and run the test programs under "LLVM IR Compiler/test/cpp", using the Makefile tasks.

## Tools Required

* The WLA DX assembler suite, version 10.4
    - WLA DX assembler suite is available at https://github.com/vhelin/wla-dx/releases
    - Other versions may also work
    - Not sure if other assemblers would work
* The BizHawk (v2.8) or BSNES-Plus (v05) emulators
    - BizHawk is available at https://github.com/devinacker/bsnes-plus/releases
    - BSNES-Plus is available at https://github.com/devinacker/bsnes-plus/releases
    - Other versions of these emulators will likely work
    - Any SNES emulator which can take a ROM file to run as a command-line argument would likely work; it is strongly recommended to use an emulator with a memory viewer.

## Assembling and Running Test SNES ROMs

1) Set up `ComputerSpecific.mak`, as specified in its section below.
2) Set up the "LLVM IR Compiler/test/Includes" directory, as specified in the Includes section below.
3) To assemble, link, and run a given test file, navigate to "LLVM IR Compiler" in a command-line/shell, and run "make test_\<test filename\>", where \<test filename\> is the name of a test file under "LLVM IR Compiler/test/cpp", without the `.cpp` extension.

## ComputerSpecific.mak

The main Makefile includes another makefile named `ComputerSpecific.mak`, which should hold paths to the 65816 assembler, 65816 linker, and SNES emulator.

Specifically, the main Makefile expects the following variables:

* `WLA_65c816` - should contain path to `wla-65816.exe`
* `WLA_LINKER` - should contain path to `wlalink.exe`
* `EMULATOR` - should contain path to SNES emulator executable.

Range of valid versions for `wla-65816` and `wlalink` is unknown; it's known that version *10.4 Win32* works.

Any emulator that can accept a `.smc` file as its first command line argument (like so: `emulator.exe test.smc`) should work; has been tested with BizHawk-2.8-win-x64.

Example `ComputerSpecific.mak`:
```
WLA_65c816 = wla-65816
WLA_LINKER = wlalink
EMULATOR = E:\Games\BizHawk\BizHawk-2.8-win-x64\EmuHawk.exe
```

## Includes

Assembly generated by the compiler includes two other user-supplied files, `header.inc` and `SNES_Init.asm`, and the Makefile tasks used to compile .asm files assumes those included files are in "LLVM IR Compiler/test/Includes". These files are not currently included in the repository, as I am unsure if the file authors are okay with my doing so.

* `header.inc`: Specifies the ROM layout and location of interrupts; required for WLA DX to know how to set up the ROM.
    - Can be found at https://wiki.superfamicom.org/writing-the-header
* `SNES_Init.asm`: Provides a macro to initialize the SNES, which is used in the generated assembly's setup code.
    - Can be found at https://wiki.superfamicom.org/setting-up-a-programming-environment, in `SNES-starter-kit.7z`
